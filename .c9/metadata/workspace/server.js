{"filter":false,"title":"server.js","tooltip":"/server.js","undoManager":{"mark":47,"position":47,"stack":[[{"start":{"row":13,"column":66},"end":{"row":19,"column":3},"action":"remove","lines":["","var con = mysql.createConnection({","    host: \"localhost\",","    user: config.user,","    password: config.password,","    database: config.database","});"],"id":2564,"ignore":true}],[{"start":{"row":13,"column":66},"end":{"row":19,"column":3},"action":"insert","lines":["","var con = mysql.createConnection({","    host: \"localhost\",","    user: config.user,","    password: config.password,","    database: config.database","});"],"id":2565,"ignore":true}],[{"start":{"row":346,"column":0},"end":{"row":369,"column":0},"action":"remove","lines":["function initServer() {","    con.connect(function (err) {","        if (err) {","            var currentdate = new Date();","            var datetime = currentdate.getDate() + \"/\"","                + (currentdate.getMonth() + 1) + \"/\"","                + currentdate.getFullYear() + \" @ \"","                + currentdate.getHours() + \":\"","                + currentdate.getMinutes() + \":\"","                + currentdate.getSeconds();","            logging.systemLog(err)","            return;","        }","        else","        {","            logging.systemLog(\"Server is running\");","        }","        ","","       ","","","    });",""],"id":2566,"ignore":true},{"start":{"row":351,"column":0},"end":{"row":352,"column":1},"action":"remove","lines":["","}"]}],[{"start":{"row":349,"column":2},"end":{"row":350,"column":18},"action":"remove","lines":["  //start the server","    startServer();"],"id":2567,"ignore":true},{"start":{"row":364,"column":0},"end":{"row":364,"column":13},"action":"remove","lines":["initServer();"]},{"start":{"row":364,"column":0},"end":{"row":365,"column":18},"action":"insert","lines":["  //start the server","    startServer();"]}],[{"start":{"row":363,"column":0},"end":{"row":363,"column":18},"action":"remove","lines":["//init the server "],"id":2568,"ignore":true},{"start":{"row":364,"column":0},"end":{"row":364,"column":2},"action":"remove","lines":["  "]},{"start":{"row":365,"column":0},"end":{"row":365,"column":4},"action":"remove","lines":["    "]}],[{"start":{"row":40,"column":0},"end":{"row":48,"column":0},"action":"remove","lines":["","app.get('/test3', function (req, res){","      var inserts = ['users','name','Test_auth'];","      var statement =mysql.format('SELECT * FROM ?? WHERE ?? = ?', inserts);","      res.send(statement);","        ","});","",""],"id":2569,"ignore":true}],[{"start":{"row":82,"column":1},"end":{"row":107,"column":1},"action":"insert","lines":["","","function CheckAuth(req, res, nex) {","    var token = req.body.token;","    console.log(token)","    if (token === undefined) {","        res.status(400).json({ 'messages': { 'strResponse': \"token unreadable\", 'status': 'Failed' } });","    }","    con.query('SELECT username FROM users WHERE token = ?', [token], function(err, data) {","        if (err) logging.errorLog(\"\", err);","        else if (data.length === 0) {","         res.status(401).send(\"Unauthorized\");","        }","        //TODO add secret to file and read it in `","        //The error is here, it seems to claim invalid even if it is valid as it still returns a matching user","        jwt.verify(token, config.secret, function(err, decoded) {","            if (err) {","                  res.status(401).send(\"Unauthorized\");","            }","            else {","              next();","            }","        });","    });","","}"],"id":2570,"ignore":true}],[{"start":{"row":84,"column":27},"end":{"row":84,"column":32},"action":"remove","lines":[", nex"],"id":2571,"ignore":true},{"start":{"row":102,"column":14},"end":{"row":102,"column":21},"action":"remove","lines":["next();"]}],[{"start":{"row":102,"column":14},"end":{"row":102,"column":26},"action":"insert","lines":["res.status()"],"id":2572,"ignore":true}],[{"start":{"row":102,"column":25},"end":{"row":102,"column":28},"action":"insert","lines":["200"],"id":2573,"ignore":true},{"start":{"row":102,"column":29},"end":{"row":102,"column":34},"action":"insert","lines":[".send"]}],[{"start":{"row":102,"column":34},"end":{"row":102,"column":46},"action":"insert","lines":["('Success');"],"id":2574,"ignore":true}],[{"start":{"row":99,"column":16},"end":{"row":99,"column":18},"action":"remove","lines":["  "],"id":2575,"ignore":true}],[{"start":{"row":99,"column":12},"end":{"row":99,"column":16},"action":"remove","lines":["    "],"id":2576,"ignore":true},{"start":{"row":99,"column":12},"end":{"row":99,"column":16},"action":"insert","lines":["    "]},{"start":{"row":102,"column":12},"end":{"row":102,"column":14},"action":"remove","lines":["  "]}],[{"start":{"row":102,"column":12},"end":{"row":102,"column":16},"action":"insert","lines":["    "],"id":2577,"ignore":true}],[{"start":{"row":130,"column":29},"end":{"row":131,"column":28},"action":"insert","lines":["","    //should make it a none "],"id":2578,"ignore":true}],[{"start":{"row":130,"column":29},"end":{"row":131,"column":28},"action":"remove","lines":["","    //should make it a none "],"id":2579,"ignore":true}],[{"start":{"row":140,"column":28},"end":{"row":140,"column":34},"action":"insert","lines":["checkA"],"id":2580,"ignore":true}],[{"start":{"row":140,"column":34},"end":{"row":140,"column":38},"action":"insert","lines":["uth "],"id":2581,"ignore":true}],[{"start":{"row":59,"column":18},"end":{"row":59,"column":20},"action":"insert","lines":["Mi"],"id":2582,"ignore":true}],[{"start":{"row":59,"column":18},"end":{"row":59,"column":20},"action":"remove","lines":["Mi"],"id":2583,"ignore":true}],[{"start":{"row":84,"column":9},"end":{"row":84,"column":18},"action":"remove","lines":["CheckAuth"],"id":2584,"ignore":true},{"start":{"row":84,"column":9},"end":{"row":84,"column":18},"action":"insert","lines":["ValidateT"]}],[{"start":{"row":84,"column":18},"end":{"row":84,"column":22},"action":"insert","lines":["oken"],"id":2585,"ignore":true}],[{"start":{"row":140,"column":28},"end":{"row":140,"column":37},"action":"remove","lines":["checkAuth"],"id":2586,"ignore":true},{"start":{"row":140,"column":28},"end":{"row":140,"column":42},"action":"insert","lines":["ValidateToken,"]}],[{"start":{"row":143,"column":27},"end":{"row":144,"column":10},"action":"insert","lines":["","        /*"],"id":2587,"ignore":true},{"start":{"row":148,"column":11},"end":{"row":149,"column":10},"action":"insert","lines":["","        */"]}],[{"start":{"row":64,"column":5},"end":{"row":65,"column":25},"action":"insert","lines":["","    connection.query(mys)"],"id":2588,"ignore":true}],[{"start":{"row":65,"column":24},"end":{"row":65,"column":35},"action":"insert","lines":["ql.format()"],"id":2589,"ignore":true}],[{"start":{"row":65,"column":34},"end":{"row":65,"column":78},"action":"insert","lines":["'SELECT username FROM users WHERE token = ?'"],"id":2590,"ignore":true}],[{"start":{"row":65,"column":78},"end":{"row":65,"column":84},"action":"insert","lines":[",token"],"id":2591,"ignore":true}],[{"start":{"row":65,"column":86},"end":{"row":65,"column":99},"action":"insert","lines":[".then(functi)"],"id":2592,"ignore":true}],[{"start":{"row":65,"column":98},"end":{"row":65,"column":110},"action":"insert","lines":["on(result){}"],"id":2593,"ignore":true}],[{"start":{"row":65,"column":109},"end":{"row":67,"column":4},"action":"insert","lines":["","        ","    "],"id":2594,"ignore":true}],[{"start":{"row":66,"column":8},"end":{"row":78,"column":11},"action":"insert","lines":["if (result.length === 0) {","         res.status(401).send(\"Unauthorized\");","        }","        //TODO add secret to file and read it in `","        //The error is here, it seems to claim invalid even if it is valid as it still returns a matching user","        jwt.verify(token, config.secret, function(err, decoded) {","            if (err) {","                  res.status(401).send(\"Unauthorized\");","            }","            else {","              next();","            }","        });"],"id":2595,"ignore":true}],[{"start":{"row":79,"column":6},"end":{"row":79,"column":7},"action":"insert","lines":[";"],"id":2596,"ignore":true}],[{"start":{"row":78,"column":11},"end":{"row":79,"column":8},"action":"insert","lines":["","        "],"id":2597,"ignore":true}],[{"start":{"row":80,"column":6},"end":{"row":80,"column":7},"action":"remove","lines":[";"],"id":2598,"ignore":true},{"start":{"row":80,"column":6},"end":{"row":80,"column":7},"action":"insert","lines":["."]}],[{"start":{"row":80,"column":6},"end":{"row":80,"column":7},"action":"remove","lines":["."],"id":2599,"ignore":true},{"start":{"row":80,"column":6},"end":{"row":83,"column":11},"action":"insert","lines":["catch(function(e){","            //catch other errors","            res.send(e);","        });"]}],[{"start":{"row":80,"column":6},"end":{"row":80,"column":7},"action":"insert","lines":["."],"id":2600,"ignore":true}],[{"start":{"row":84,"column":3},"end":{"row":99,"column":7},"action":"remove","lines":[" con.query('SELECT username FROM users WHERE token = ?', [token], function(err, data) {","        if (err) logging.errorLog(\"\", err);","        else if (data.length === 0) {","         res.status(401).send(\"Unauthorized\");","        }","        //TODO add secret to file and read it in `","        //The error is here, it seems to claim invalid even if it is valid as it still returns a matching user","        jwt.verify(token, config.secret, function(err, decoded) {","            if (err) {","                  res.status(401).send(\"Unauthorized\");","            }","            else {","              next();","            }","        });","    });"],"id":2601,"ignore":true}],[{"start":{"row":91,"column":1},"end":{"row":93,"column":5},"action":"remove","lines":["   if (token === undefined) {","        res.status(400).json({ 'messages': { 'strResponse': \"token unreadable\", 'status': 'Failed' } });","    }"],"id":2602,"ignore":true},{"start":{"row":91,"column":1},"end":{"row":115,"column":0},"action":"insert","lines":["","       if (token === undefined) {","        res.status(400).json({ 'messages': { 'strResponse': \"token unreadable\", 'status': 'Failed' } });","    }","    connection.query(mysql.format('SELECT username FROM users WHERE token = ?',token)).then(function(result){","        if (result.length === 0) {","         res.status(401).send(\"Unauthorized\");","        }","        //TODO add secret to file and read it in `","        //The error is here, it seems to claim invalid even if it is valid as it still returns a matching user","        jwt.verify(token, config.secret, function(err, decoded) {","            if (err) {","                  res.status(401).send(\"Unauthorized\");","            }","            else {","              next();","            }","        });","        ","    }).catch(function(e){","            //catch other errors","            res.send(e);","        });","   ",""]}],[{"start":{"row":106,"column":13},"end":{"row":106,"column":21},"action":"remove","lines":[" next();"],"id":2603,"ignore":true},{"start":{"row":106,"column":13},"end":{"row":106,"column":46},"action":"insert","lines":[" res.status(200).send('Success');"]},{"start":{"row":116,"column":1},"end":{"row":132,"column":0},"action":"remove","lines":["   con.query('SELECT username FROM users WHERE token = ?', [token], function(err, data) {","        if (err) logging.errorLog(\"\", err);","        else if (data.length === 0) {","         res.status(401).send(\"Unauthorized\");","        }","        //TODO add secret to file and read it in `","        //The error is here, it seems to claim invalid even if it is valid as it still returns a matching user","        jwt.verify(token, config.secret, function(err, decoded) {","            if (err) {","                res.status(401).send(\"Unauthorized\");","            }","            else {","                res.status(200).send('Success');","            }","        });","    });",""]}],[{"start":{"row":115,"column":0},"end":{"row":116,"column":1},"action":"remove","lines":[""," "],"id":2604,"ignore":true}],[{"start":{"row":152,"column":27},"end":{"row":158,"column":10},"action":"remove","lines":["","        /*","        CheckAuth(token, function (callback, responseStatus) {","            ","            res.json({ 'messages':{'strResponse': callback, \"status\": responseStatus}, 'userDetails':{'fName': 'Hassan' }});","        });","        */"],"id":2605,"ignore":true}],[{"start":{"row":149,"column":69},"end":{"row":152,"column":27},"action":"remove","lines":["","        var token = req.body.token;","        //verify token sent to server","        console.log(token);"],"id":2606,"ignore":true}],[{"start":{"row":149,"column":42},"end":{"row":149,"column":67},"action":"remove","lines":[" function (req, res, err)"],"id":2607,"ignore":true}],[{"start":{"row":149,"column":41},"end":{"row":149,"column":42},"action":"remove","lines":[","],"id":2608,"ignore":true},{"start":{"row":149,"column":41},"end":{"row":149,"column":42},"action":"insert","lines":[")"]},{"start":{"row":149,"column":42},"end":{"row":149,"column":43},"action":"remove","lines":[" "]}],[{"start":{"row":150,"column":0},"end":{"row":150,"column":2},"action":"remove","lines":["})"],"id":2609,"ignore":true}],[{"start":{"row":150,"column":0},"end":{"row":150,"column":1},"action":"insert","lines":["}"],"id":2610,"ignore":true}],[{"start":{"row":149,"column":42},"end":{"row":150,"column":1},"action":"remove","lines":["{","}"],"id":2611,"ignore":true}]]},"ace":{"folds":[],"customSyntax":"javascript","scrolltop":1320,"scrollleft":0,"selection":{"start":{"row":96,"column":34},"end":{"row":96,"column":34},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":87,"state":"no_regex","mode":"ace/mode/javascript"}},"timestamp":1505076678722,"hash":"0b2afc91e847c8bf4ba46b66f9cbd0f1790f4226"}